@model Pastebook.Models.ProfileViewModel

@{
    ViewBag.Title = Model.User.FIRST_NAME + " " + Model.User.LAST_NAME;
}

<div id="profile">
    <div class="container">
        <div class="row">
            <div id="profile-header" class="container">
                <div class="col-md-12 text-center" >
                    <div id="profile-profile-picture col-md-6">
                        @if (Model.User.PROFILE_PIC == null)
                        {
                        <img src="@Url.Content("~/Content/Images/pastebook-default.png")" id="profile-prof-pic" alt=@Model.User.FIRST_NAME @Model.User.LAST_NAME>
                        }

                        else
                        {
                            var base64 = Convert.ToBase64String(Model.User.PROFILE_PIC);
                            var imgSrc = String.Format("data:image/gif;base64,{0}", base64);

                            <img src=@imgSrc type="hidden" id="profile-prof-pic" alt=@Model.User.FIRST_NAME @Model.User.LAST_NAME>
                        }

                        @if (Model.User.USER_NAME == Session["Username"].ToString())
                        {
                        <span class="glyphicon glyphicon-camera" id="camera-icon" data-toggle="modal" data-target="#picModal"></span>
                        }
                    </div>

                    <div class="text-center">
                        <div id="profile-fullname">
                            @Html.ActionLink(Model.User.FIRST_NAME + " " + Model.User.LAST_NAME, "Index", new { username = Model.User.USER_NAME }, null)
                        </div>
                        <div id="profile-username">
                            (@Model.User.USER_NAME)
                        </div>                    
                        <div id="interactButtons">
                            @{Html.RenderAction("GetInteractButtons", "Friend", new { id = Model.User.ID });}
                        </div>
                    </div>

                </div>

                @*<div id="profile-header-sidediv" class="col-md-6">

                </div>*@
            </div>  
        </div>

        <div class="row">
            <div id="profile-content">
                <div class="col-md-4" id="profile-user-details">
                    @{Html.RenderAction("GetProfileDetails", "Profile", new { username = Model.User.USER_NAME });}
                </div>
            </div>

            @if ((Model.User.ID == (int)Session["UserId"]) || (Model.ListOfFriends.Where(x=>x.REQUEST == "Y").Any(x => x.FRIEND_ID == (int)Session["UserId"]))  || (Model.ListOfFriends.Where(x => x.REQUEST == "Y").Any(x => x.USER_ID == (int)Session["UserId"])))
            {
                <div class="col-md-8">
                <div id="profile-options-header">
                    <span id="profile-options-post" class="profile-options">Timeline</span>
                    <span id="profile-options-friend" class="profile-options">Friends</span>

                </div>

                <div id="writePost" class="container">
                    
                    @if ((int)Session["UserId"] == Model.User.ID)
                    {
                        <textarea rows="5" cols="70" id="textAreaPost" placeholder="What's on your mind?" class="col-md-12"></textarea>
                    }

                    else
                    {
                        <textarea rows="5" cols="70" id="textAreaPost" placeholder="Write something..." class="col-md-12"></textarea>
                    }
                      <div class="clearfix"><button type="button" value=@Model.User.ID class="btn pull-right" id="btnPost" />Post</div>
                </div>

                <div id="timelinePost">
                    @{Html.RenderAction("GetTimelinePosts", "Post", new { id = Model.User.ID });}
                </div>

                <div id="friend-list" class="container">
                    <div id="profile-friend-list-header">@Model.User.FIRST_NAME's friends</div>
                    @{Html.RenderAction("GetFriendList", "Friend", new { id = Model.User.ID });}
                </div>
                </div>
            }
        </div>
    </div>
</div>

<div id="picModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Choose Photo</h4>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("FileUpload", "Pastebook", FormMethod.Post,
                new { enctype = "multipart/form-data" }))
                {
                    <div class="form-group">
                        <input type="file" name="file" id="file" class="btn" style="width: 100%;" />
                    </div>

                    <div class="form-group clearfix">
                        <input type="submit" value="Upload" id="upload" class="submit btn btn-default pull-right" />
                    </div>

                    <div class="form-group clearfix">
                        <span id="pictureStatus"></span>
                    </div>

                }
                    </div>
        </div>

    </div>
</div>

@section scripts{
    <script>
        var createPostURL = '@Url.Action("CreatePost", "Post")'
        var addLikeURL = '@Url.Action("AddLike", "Like")'
        var addCommentURL = '@Url.Action("AddComment", "Comment")'
        var interactButtonsUrl = '@Url.Action("GetInteractButtons", "Friend", new { id = Model.User.ID })'
        var getTimelinePostUrl = '@Url.Action("GetTimelinePosts", "Post", new { id = Model.User.ID })'
        var getProfileDetails = '@Url.Action("GetProfileDetails", "Profile", new { username = Model.User.USER_NAME })';
        var errorURL = '@Url.Action("ErrorPage","Error")';
        var updateProfileURL = '@Url.Action("UpdateProfile","Profile")';
        var unlikeURL = '@Url.Action("Unlike", "Like")';
        var checkAboutMeURL = '@Url.Action("CheckAboutMeIfValid", "Profile")';
        var checkPostValid = '@Url.Action("CheckIfPostValid", "Post")';
        var checkCommentValid = '@Url.Action("CheckIfCommentIsValid", "Comment")';
        var result = '@ViewBag.Result';
    </script>
    <script src="~/Scripts/PastebookScripts/profileScript.js"> </script>
}


