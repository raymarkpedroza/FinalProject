@model Pastebook.Models.EditProfileViewModel


@{
    ViewBag.Title = "Change Password";
}

@using (Html.BeginForm("ChangePassword", "Profile", FormMethod.Post))
{
<div class="form-horizontal container"> 
    <div class="col-md-offset-2 col-md-8" id="edit-profile">
    <span class="edit-profile-header">Change Password</span>
    <hr />
    <span class="edit-profile-subheader">Fill up the required fields(*).</span>
        <div id="change-password" class="container">
                <div class="form-group">
                    <span class="col-md-4"><span class="glyphicon glyphicon-lock"></span> New Password* </span>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @class = "text-line", placeholder = "password", id="txtPassword" } })
                        @Html.ValidationMessageFor(model => model.Password, "", new { @class = "text-danger" })
                        <span class="label-danger validation" id="passwordValidation"></span>
                    </div>
                </div>

                <div class="form-group">
                    <span class="col-md-4"><span class="glyphicon glyphicon-lock"></span> Confirm Password*</span>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.ConfirmPassword, new { htmlAttributes = new { @class = "text-line", placeholder = "re-enter password" } })
                        @Html.ValidationMessageFor(model => model.ConfirmPassword, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    <span class="col-md-4"><span class="glyphicon glyphicon-lock"></span> Current Password*</span>
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.CurrentPassword, new { htmlAttributes = new { @class = "text-line", placeholder = "enter current password" } })
                        @Html.ValidationMessageFor(model => model.CurrentPassword, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    <div class="pull-right ">
                        <input type="submit" value="Change Password" class="btn btn-default" />
                        <input type="button" value="Cancel" class="btn btn-default" id="btnCancel" />
                    </div>
                </div>
            </div>
    </div>
</div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        var checkPasswordIfYourCurrentPasswordUrl = '@Url.Action("CheckIfPasswordYourCurrentPassword", "Profile")'
        var result = '@ViewBag.Result';
    </script>
    <script>
        $(document).ready(function () {
            if (result) {
                $("#successModal-header").text("Success")
                $("#successModal-body").text("Password updated successfully")
                $("#successModal").modal('show')
            }
            $("#txtPassword").blur(function () {
                var data = {
                    password: $("#txtPassword").val()
                }

                $.ajax({
                    url: checkPasswordIfYourCurrentPasswordUrl,
                    data: data,
                    type: 'POST',
                    success: function (data) {
                        if (data.result) {
                            $("#passwordValidation").text("This is your current password");
                        }
                        else {
                            $("#passwordValidation").text("");
                        }
                    },

                    error: function () {
                        $("#errorModal-header").text("Error")
                        $("#errorModal-body").text("Something went wrong when processing request")
                        $("#errorModal").modal('show')
                    }

                    })
            });

            $("#txtUsername").keyup(function () {
                $("#passwordValidation").text("");
            });
        });
    </script>
}
